# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Vite

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/main.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```
# Интернет-магазин «Web-Larёk»
«Web-Larёk» — это интернет-магазин с товарами для веб-разработчиков, где пользователи могут просматривать товары, добавлять их в корзину и оформлять заказы. Сайт предоставляет удобный интерфейс с модальными окнами для просмотра деталей товаров, управления корзиной и выбора способа оплаты, обеспечивая полный цикл покупки с отправкой заказов на сервер.

## Архитектура приложения

Код приложения разделен на слои согласно парадигме MVP (Model-View-Presenter), которая обеспечивает четкое разделение ответственности между классами слоев Model и View. Каждый слой несет свой смысл и ответственность:

Model - слой данных, отвечает за хранение и изменение данных.  
View - слой представления, отвечает за отображение данных на странице.  
Presenter - презентер содержит основную логику приложения и  отвечает за связь представления и данных.

Взаимодействие между классами обеспечивается использованием событийно-ориентированного подхода. Модели и Представления генерируют события при изменении данных или взаимодействии пользователя с приложением, а Презентер обрабатывает эти события используя методы как Моделей, так и Представлений.

### Базовый код

#### Класс Component
Является базовым классом для всех компонентов интерфейса.
Класс является дженериком и принимает в переменной `T` тип данных, которые могут быть переданы в метод `render` для отображения.

Конструктор:  
`constructor(container: HTMLElement)` - принимает ссылку на DOM элемент за отображение, которого он отвечает.

Поля класса:  
`container: HTMLElement` - поле для хранения корневого DOM элемента компонента.

Методы класса:  
`render(data?: Partial<T>): HTMLElement` - Главный метод класса. Он принимает данные, которые необходимо отобразить в интерфейсе, записывает эти данные в поля класса и возвращает ссылку на DOM-элемент. Предполагается, что в классах, которые будут наследоваться от `Component` будут реализованы сеттеры для полей с данными, которые будут вызываться в момент вызова `render` и записывать данные в необходимые DOM элементы.  
`setImage(element: HTMLImageElement, src: string, alt?: string): void` - утилитарный метод для модификации DOM-элементов `<img>`


#### Класс Api
Содержит в себе базовую логику отправки запросов.

Конструктор:  
`constructor(baseUrl: string, options: RequestInit = {})` - В конструктор передается базовый адрес сервера и опциональный объект с заголовками запросов.

Поля класса:  
`baseUrl: string` - базовый адрес сервера  
`options: RequestInit` - объект с заголовками, которые будут использованы для запросов.

Методы:  
`get(uri: string): Promise<object>` - выполняет GET запрос на переданный в параметрах ендпоинт и возвращает промис с объектом, которым ответил сервер  
`post(uri: string, data: object, method: ApiPostMethods = 'POST'): Promise<object>` - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на ендпоинт переданный как параметр при вызове метода. По умолчанию выполняется `POST` запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.  
`handleResponse(response: Response): Promise<object>` - защищенный метод проверяющий ответ сервера на корректность и возвращающий объект с данными полученный от сервера или отклоненный промис, в случае некорректных данных.

#### Класс EventEmitter
Брокер событий реализует паттерн "Наблюдатель", позволяющий отправлять события и подписываться на события, происходящие в системе. Класс используется для связи слоя данных и представления.

Конструктор класса не принимает параметров.

Поля класса:  
`_events: Map<string | RegExp, Set<Function>>)` -  хранит коллекцию подписок на события. Ключи коллекции - названия событий или регулярное выражение, значения - коллекция функций обработчиков, которые будут вызваны при срабатывании события.

Методы класса:  
`on<T extends object>(event: EventName, callback: (data: T) => void): void` - подписка на событие, принимает название события и функцию обработчик.  
`emit<T extends object>(event: string, data?: T): void` - инициализация события. При вызове события в метод передается название события и объект с данными, который будет использован как аргумент для вызова обработчика.  
`trigger<T extends object>(event: string, context?: Partial<T>): (data: T) => void` - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие с передачей в него данных из второго параметра.

---------------------------------


## Модель данных приложения:

Интерфейс IProduct описывает структуру данных товара.
Поля:
id: string - уникальный идентификатор товара
description: string - описание товара
image: string - ссылка на изображение товара
title: string - название товара
category: string - категория товара
price: number | null - цена товара (может быть null, если товар недоступен)

Интерфейс IBuyer описывает структуру данных покупателя.
Поля:
payment: string - способ оплаты
email: string - email покупателя
phone: string - телефон покупателя
address: string - адрес доставки
total: number - общая сумма заказа
items: string[] - массив идентификаторов товаров в заказе


## Классы моделей
- хранение товаров, которые можно купить в приложении;
- хранение товаров, которые пользователь выбрал для покупки;
- данные покупателя, которые тот должен указать при оформлении заказа.

Класс Products 
Хранит массив всех товаров и товар, выбранный для подробного отображения.
Конструктор: constructor() — конструктор без параметров.
Поля класса:
* items: IProduct[] - массив товаров.
* viewItem: IProduct | null = null - Товар, выбранный для отображения.
Методы класса:
* setItems(items: IProduct[]): void - сохранение массива товаров полученного в параметрах метода.
* getItems(): IProduct[] - получение массива товаров из модели.
* getItemById(id: string): IProduct | undefined - получение одного товара по его id.
* setViewItem(item: IProduct): void - сохранение товара для подробного отображения.
* getViewItem(): IProduct | null - получение товара для подробного отображения.

Класс Cart
Хранит массив товаров, выбранных покупателем для покупки.
Конструктор: constructor() — конструктор без параметров.
Поля класса:
* items: IProduct[] = [] - Массив всех товаров
Методы класса:
* getItems(): IProduct[] - получение массива товаров, которые находятся в корзине.
* addItem(item: IProduct): void - добавление товара, который был получен в параметре, в массив корзины.
* removeItem(item: IProduct): void - удаление товара, полученного в параметре из массива корзины.
* clear(): void - очистка корзины.
* getTotalPrice(): number - получение стоимости всех товаров в корзине.
* getTotalCount(): number - получение количества товаров в корзине.
* hasItem(id: string): boolean - проверка наличия товара в корзине по его id, полученного в параметр метода.

Класс Buyer
Хранит данные покупателя, необходимые для оформления заказа, и выполняет их валидацию.
Конструктор: constructor() — конструктор без параметров.
Поля класса:
payment: string - способ оплаты
email: string - email покупателя
phone: string - телефон покупателя
address: string - адрес доставки
Методы класса:
* setData(data: Partial<IBuyer>): void - сохранение данных в модели.
* setPayment(payment: TPayment): void - сохранение способа оплаты.
* setEmail(email: string): void - сохранение email.
* setPhone(phone: string): void - сохранение телефона.
* setAddress(address: string): void - сохранение адреса.
* getData(): IBuyer - получение всех данных покупателя.
* clear(): void - очистка данных покупателя.
* validate(): Record<string, string> - валидация данных.

## Слой коммуникации
Класс ShopAhi
Представляет коммуникационный слой — он будет отвечать за получение данных с сервера и отправку данных на сервер.
Конструктор: принимает объект api, реализующий интерфейс IApi.
Методы класса:
* getProducts(): Promise<IProduct[]> - Получение списка товаров.
* createOrder(order: IOrderRequest): Promise<IOrderResponse> - Создание заказа.

## Слой Представления (View)
Базовые классы:
Component<T> - абстрактный базовый класс для всех компонентов
BaseForm<T> - базовый класс для всех форм с валидацией
BaseCard<T> - базовый класс для всех карточек товаров

### Основные компоненты

Layout компоненты
1. Header - шапка приложения: Отображает логотип и кнопку корзины, показывает счетчик товаров в корзине, генерирует событие header:basket:open при клике на корзину.
2. Gallery - контейнер для каталога товаров: Отображает массив карточек товаров, простой контейнер без дополнительной логики
3. Modal - модальное окно: Универсальный компонент для отображения любого контента, поддерживает закрытие по клику вне области или по кнопке
Методы: open(), close(), setContent()

Карточки товаров
1. BaseCard<T> - базовый класс для карточек
Общие свойства: id, title, image, category, price
Применение CSS-модификаторов для категорий товаров
2. CardCatalog - карточка в каталоге: Отображает товар в списке каталога, генерирует событие catalog:card:selected при клике
3. CardPreview - детальный просмотр товара: показывает полную информацию о товаре, кнопка "В корзину" / "Удалить из корзины", генерирует события preview:buy или preview:remove
4. CardBasket - товар в корзине: отображает товар в списке корзины с номером, кнопка удаления товара, генерирует событие basket:item:remove

Формы
1. BaseForm<T> - базовый класс для форм: обработка событий input и submit, валидация и отображение ошибок, управление состоянием кнопки отправки
2. OrderForm - форма заказа (шаг 1): выбор способа оплаты (карта/наличные), поле ввода адреса доставки,валидация обязательных полей, генерирует события order:change и order:next
2. ContactsForm - форма контактов (шаг 2): поля email и телефон, валидация и отображение ошибок, генерирует события contacts:change и contacts:submit

Специализированные представления
1. BasketView - представление корзины: список товаров в корзине, общая стоимость заказа, кнопка "Оформить", обработка пустой корзины,
Генерирует событие basket:checkout
2. OrderSuccess - страница успешного заказа: отображение суммы списанных синапсов, кнопка "За новыми покупками!", генерирует событие success:close

События View слоя
1. Событие	2. Источник	3. Назначение
1. header:basket:open	2. Header	3. Открытие корзины
1. catalog:card:selected	2. CardCatalog	3. Выбор товара
1. preview:buy	2. CardPreview	3. Добавление в корзину
1. preview:remove	2. CardPreview	3. Удаление из корзины
1. basket:item:remove	2. CardBasket	3. Удаление товара из корзины
1. basket:checkout	2. BasketView	3. Оформление заказа
1. order:change	2. OrderForm	3. Изменение данных заказа
1. order:next	2. OrderForm	3. Переход к следующему шагу
1. contacts:change	2. ContactsForm	3. Изменение контактов
1. contacts:submit	2. ContactsForm	3. Отправка заказа
1. success:close	2. OrderSuccess	3. Закрытие окна успеха

## Слой Презентер ( Логика приложения)
Презентер координирует взаимодействие между Model и View через Event-Driven Architecture. Реализован в main.ts как центральная система управления состоянием приложения.

Архитектура:
1.Инициализация системы
const events = new EventEmitter();
const productsModel = new Products(events);
const cartModel = new Cart(events);
const buyerModel = new Buyer(events);
const shopApi = new ShopApi(new Api(API_URL));

2. Основные представления
const header = new Header(ensureElement('.header'), events);
const gallery = new Gallery(ensureElement('.gallery'));
const modal = new Modal(ensureElement('#modal-container'));

Ключевые функции:
1. Управление каталогом:
renderCatalog() - отображение товаров
openPreview() - детальный просмотр товара
createCatalogCard() - создание карточки товара
3. Управление корзиной:
openBasket() - отображение корзины
Обработка добавления/удаления товаров
Синхронизация счетчика в шапке
3. Процесс заказа:
openOrderStep1() - форма оплаты и адреса
openOrderStep2() - форма контактов
openSuccess() - результат заказа

Основные события:
products:changed - Обновление каталога
catalog:card:selected - Выбор товара
preview:buy/remove - Добавление/удаление из корзины
cart:changed - Обновление UI корзины
order:change - Сохранение данных заказа
contacts:submit - Отправка заказа на сервер


